{% extends "base.html" %} 

{% block metaheader %}

<meta name="description" content="Thank you for the support of Kotmin / GroovyTechCat / my workflows. Paweł Tłusty" />

{% endblock %}

{% block title %} Donate {% endblock %}

{% block content %}


<div class="container col-xxl-6 px-4 py-5">
  <h3>One-time payment</h3>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;" >
    
    <div id="blik-button-container"></div>
    
    <div style="  overflow-x: hidden; max-width: 100%;height: auto;">
      <div class="circle-container" >
        <img class="circle-photo" alt="Happy photo of some bearded programmer" src="{{ url_for('static', filename='res/PXL_20230627_162051172 — kopia.jpg') }}"/>
      </div>
       
      <p style="justify-content: center; align-items: center;">Thank you for the support.</p>
      <form id="donation-form">
        <label for="donation-amount">Donation Amount:</label>
        <input type="number" id="donation-amount" name="donation-amount" value="5.00"><b>PLN</b>
      </form>
      
    </div>
    
  </div>
</div>

<div class="container col-xxl-6 px-4 py-5">
  <h3>Regular Support</h3>
  <div id="pp-regular-sub">
    <form action="https://www.paypal.com/donate" method="post" target="_top">
      <input type="hidden" name="hosted_button_id" value="PF7TG6PPUBVHQ" />
      <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
      <!-- <img alt="" border="0" src="https://www.paypal.com/en_PL/i/scr/pixel.gif" width="1" height="1" /> -->
      </form>
      
  </div>
</div>
  
<script src="https://www.paypal.com/sdk/js?client-id=ASEqoEQAojwZY0_oCFj6v9FJ_IltbwW_OwmXFNAvq_CtyykxI490PiiWXJpCSA-utBXazxJeqvsO-eQ7&components=buttons,payment-fields,marks,funding-eligibility&enable-funding=blik&currency=PLN"></script>


<script>


let amount = document.getElementById('donation-amount').value;

paypal.Buttons({

  onClick()  {
    amount = document.getElementById('donation-amount').value;
},


  onInit(data, actions)  {


      // Disable the buttons

      // actions.disable();


      document.querySelector('#donation-amount')

        .addEventListener('change', function(event) {

          if(event.target.value === ''){
            actions.disable();

          } else  {

            actions.enable();

          }

      });

      },

      onCancel(data) {

 
      showToast("Donation has been canceled.", "secondary");

      },

      onError(err) {

      showToast("Some error occured. Make sure that your donation value is bigger than 1 PLN" +  + err.message, "danger");

      },


    createOrder() {
     return fetch("/my-server/create-paypal-order", {
       method: "POST",
       headers: {
         "Content-Type": "application/json",
       },
       body: JSON.stringify({
         cart: [
           {
             sku: "DONATION_PLN",
            //  quantity: "YOUR_PRODUCT_QUANTITY",amount
            quantity: amount,
           },
         ],
       }),
     })
     .then((response) => response.json())
     .then((order) => order.id);
   },
   onApprove(data) {
     return fetch(`/my-server/capture-paypal-order`, {
       method: "POST",
       headers: {
         "Content-Type": "application/json",
       },
       body: JSON.stringify({
         orderID: data.orderID
       })
     })
     .then((response) => response.json())
     .then((orderData) => {
       // Successful capture!
      //  console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
       const transaction = orderData.purchase_units[0].payments.captures[0];
      //  console.log('Transaction Status:',  transaction.status);
      //  console.log('Transaction ID:', transaction.id);
       


      showToast("Donation has been done", "success");


     });
   }
 }).render('#blik-button-container');
 //This function displays payment buttons on  web page.


</script>

{% endblock %}
